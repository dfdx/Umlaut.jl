<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reference · Umlaut</title><meta name="title" content="Reference · Umlaut"/><meta property="og:title" content="Reference · Umlaut"/><meta property="twitter:title" content="Reference · Umlaut"/><meta name="description" content="Documentation for Umlaut."/><meta property="og:description" content="Documentation for Umlaut."/><meta property="twitter:description" content="Documentation for Umlaut."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">Umlaut</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Main</a></li><li><a class="tocitem" href="../trace/">Linearized traces</a></li><li><a class="tocitem" href="../tape/">Tape anatomy</a></li><li><a class="tocitem" href="../loops/">Loops</a></li><li><a class="tocitem" href="../ghost/">Migration from Ghost</a></li><li class="is-active"><a class="tocitem" href>Reference</a><ul class="internal"><li><a class="tocitem" href="#Public-API"><span>Public API</span></a></li><li><a class="tocitem" href="#Tape-execution"><span>Tape execution</span></a></li><li><a class="tocitem" href="#Internal-functions"><span>Internal functions</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/dfdx/Umlaut.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/dfdx/Umlaut.jl/blob/main/docs/src/reference.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Public-API"><a class="docs-heading-anchor" href="#Public-API">Public API</a><a id="Public-API-1"></a><a class="docs-heading-anchor-permalink" href="#Public-API" title="Permalink"></a></h2><h3 id="Tracing"><a class="docs-heading-anchor" href="#Tracing">Tracing</a><a id="Tracing-1"></a><a class="docs-heading-anchor-permalink" href="#Tracing" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.trace" href="#Umlaut.trace"><code>Umlaut.trace</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">trace(f, args...; ctx=BaseCtx())</code></pre><p>Trace function call, return the result and the corresponding Tape. <code>trace</code> records to the tape primitive methods and recursively dives into non-primitives.</p><p>Tracing can be customized using a context and the following methods:</p><ul><li>isprimitive(ctx, f, args...) - decides whethere <code>f(args...)</code> should be treated as a primitive.</li><li>record<em>primitive!(tape::Tape{C}, v</em>f, v<em>args...) - records the primitive call defined by variables `f</em>v(v_args...)` to the tape.</li></ul><p>The default context is <code>BaseCtx()</code>, which treats all functions from standard Julia modules as primitives and simply pushes the call to the tape. See the docstrings of these functions for further examples of customization.</p><p><strong>Examples:</strong></p><pre><code class="nohighlight hljs">foo(x) = 2x
bar(x) = foo(x) + 1

val, tape = trace(bar, 2.0)
# (5.0, Tape{Dict{Any, Any}}
#   inp %1::typeof(bar)
#   inp %2::Float64
#   %3 = *(2, %2)::Float64
#   %4 = +(%3, 1)::Float64
# )

val, tape = trace(bar, 2.0; ctx=BaseCtx([*, +, foo]))
# (5.0, Tape{Dict{Any, Any}}
#   inp %1::typeof(bar)
#   inp %2::Float64
#   %3 = foo(%2)::Float64
#   %4 = +(%3, 1)::Float64
# )

struct MyCtx end

isprimitive(ctx::MyCtx, f, args...) = isprimitive(BaseCtx(), f, args...) || f in [foo]
val, tape = trace(bar, 2.0; ctx=MyCtx())
# (5.0, Tape{Dict{Any, Any}}
#   inp %1::typeof(bar)
#   inp %2::Float64
#   %3 = foo(%2)::Float64
#   %4 = +(%3, 1)::Float64
# )</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L625-L676">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.isprimitive" href="#Umlaut.isprimitive"><code>Umlaut.isprimitive</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">isprimitive(ctx::BaseCtx, f, args...)</code></pre><p>The default implementation of <code>isprimitive</code> used in <a href="#Umlaut.trace"><code>trace()</code></a>. Returns <code>true</code> if the method with the provided signature is defined in one of the Julia&#39;s built-in modules, e.g. <code>Base</code>, <code>Core</code>, <code>Broadcast</code>, etc.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L142-L148">source</a></section><section><div><pre><code class="language-julia hljs">isprimitive(ctx::Any, f, args...)</code></pre><p>Fallback implementation of <code>isprimitive()</code>, behaves the same way as <code>isprimitive(BaseCtx(), f, args...)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L163-L168">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.record_primitive!" href="#Umlaut.record_primitive!"><code>Umlaut.record_primitive!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">record_primitive!(tape::Tape{C}, v_fargs...) where C</code></pre><p>Record a primitive function call to the tape.</p><p>By default, this function simply pushes the function call to the tape, but it can also be overwritten to do more complex logic. For example, instead of recording the function call, a user can push one or more other calls, essentially implementing <code>replace!()</code> right during the tracing and without calling the function twice.</p><p><strong>Examples:</strong></p><p>The following code shows how to replace f(args...) with ChainRules.rrule(f, args...) duing the tracing:</p><pre><code class="nohighlight hljs">function record_primitive!(tape::Tape{RRuleContext}, v_fargs)
    v_rr = push!(tape, mkcall(rrule, v_fargs...))
    v_val = push!(tape, mkcall(getfield, v_rr, 1))
    v_pb = push!(tape, mkcall(getfield, v_rr, 1))
    tape.c.pullbacks[v_val] = v_pb
    return v_val   # the function should return Variable with the result
end</code></pre><p>See also: <a href="#Umlaut.isprimitive"><code>isprimitive()</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L192-L219">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.BaseCtx" href="#Umlaut.BaseCtx"><code>Umlaut.BaseCtx</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Dict-like tracing context that treats as primitives all functions from the standard Julia modules (e.g. Base, Core, Statistics, etc.)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L120-L123">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.__new__" href="#Umlaut.__new__"><code>Umlaut.__new__</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">__new__(T, args...)</code></pre><p>User-level version of the <code>new()</code> pseudofunction. Can be used to construct most Julia types, including structs without default constructors, closures, etc.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/utils.jl#L5-L10">source</a></section></article><h3 id="Variables"><a class="docs-heading-anchor" href="#Variables">Variables</a><a id="Variables-1"></a><a class="docs-heading-anchor-permalink" href="#Variables" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.Variable" href="#Umlaut.Variable"><code>Umlaut.Variable</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Variable represents a reference to an operation on a tape. Variables can be used to index tape or keep reference to a specific operation on the tape.</p><p>Variables (also aliesed as <code>V</code>) can be:</p><ul><li>free, created as <code>V(id)</code> - used for indexing into tape</li><li>bound, created as <code>V(op)</code> or V(tape, id) - used to keep a robust reference to an operation on the tape</li></ul><p>See also: <a href="#Umlaut.bound"><code>bound</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L10-L22">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.bound" href="#Umlaut.bound"><code>Umlaut.bound</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">bound(tape::Tape, v::Variable)
V(tape::Tape, v::Integer)
%(tape::Tape, i::Integer)</code></pre><p>Create version of the var bound to an operation on the tape. The short syntax <code>tape %i</code> is convenient for working in REPL, but may surprise a reader of your code. Use it wisely.</p><p><strong>Examples:</strong></p><pre><code class="nohighlight hljs">V(3)                # unbound var
V(tape, 3)          # bound var
bound(tape, 3)      # bound var
bound(tape, V(3))   # bound var
tape %3             # bound var</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L466-L483">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.rebind!" href="#Umlaut.rebind!"><code>Umlaut.rebind!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rebind!(tape::Tape, op, st::Dict)
rebind!(tape::Tape, st::Dict; from, to)</code></pre><p>Rebind all variables according to substitution table. Example:</p><pre><code class="nohighlight hljs">tape = Tape()
v1, v2 = inputs!(tape, nothing, 3.0, 5.0)
v3 = push!(tape, mkcall(*, v1, 2))
st = Dict(v1.id =&gt; v2.id)
rebind!(tape, st)
@assert tape[v3].args[1].id == v2.id</code></pre><p>See also: rebind_context!()</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L489-L503">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.rebind_context!" href="#Umlaut.rebind_context!"><code>Umlaut.rebind_context!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">rebind_context!(tape::Tape, st::Dict)</code></pre><p>Rebind variables in the tape&#39;s context according to substitution table. By default does nothing, but can be overwitten for specific Tape{C}</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L524-L529">source</a></section></article><h3 id="Tape-structure"><a class="docs-heading-anchor" href="#Tape-structure">Tape structure</a><a id="Tape-structure-1"></a><a class="docs-heading-anchor-permalink" href="#Tape-structure" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.Tape" href="#Umlaut.Tape"><code>Umlaut.Tape</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Linearized representation of a function execution.</p><p><strong>Fields</strong></p><ul><li><code>ops</code> - vector of operations on the tape</li><li><code>result</code> - variable pointing to the operation to be used as the result</li><li><code>parent</code> - parent tape if any</li><li><code>meta</code> - internal metadata</li><li><code>c</code> - application-specific context</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L231-L242">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.AbstractOp" href="#Umlaut.AbstractOp"><code>Umlaut.AbstractOp</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Base type for operations on a tape</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L1-L3">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.Input" href="#Umlaut.Input"><code>Umlaut.Input</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Operation representing input data of a tape</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L102">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.Constant" href="#Umlaut.Constant"><code>Umlaut.Constant</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Operation representing a constant value on a tape</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L118">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.Call" href="#Umlaut.Call"><code>Umlaut.Call</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Operation represening function call on tape. Typically, calls are constructed using <a href="#Umlaut.mkcall"><code>mkcall</code></a> function.</p><p>Important fields of a Call{T}:</p><ul><li><code>fn::T</code> - function or object to be called</li><li><code>args::Vector</code> - vector of variables or values used as arguments</li><li><code>val::Any</code> - the result of the function call</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L136-L145">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.Loop" href="#Umlaut.Loop"><code>Umlaut.Loop</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Operation representing a loop in an computational graph. See the online documentation for details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L439-L442">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.inputs" href="#Umlaut.inputs"><code>Umlaut.inputs</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Get list of a tape input variables</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L286">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.inputs!" href="#Umlaut.inputs!"><code>Umlaut.inputs!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Set values of a tape inputs</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L289">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.mkcall" href="#Umlaut.mkcall"><code>Umlaut.mkcall</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mkcall(fn, args...; val=missing, kwargs=(;))</code></pre><p>Convenient constructor for Call operation. If val is <code>UncalculatedValue</code> (default) and call value can be calculated from (bound) variables and constants, they are calculated. To prevent this behavior, set val to some neutral value.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L181-L187">source</a></section></article><h3 id="Tape-transformations"><a class="docs-heading-anchor" href="#Tape-transformations">Tape transformations</a><a id="Tape-transformations-1"></a><a class="docs-heading-anchor-permalink" href="#Tape-transformations" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.push!" href="#Base.push!"><code>Base.push!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">push!(tape::Tape, op::AbstractOp)</code></pre><p>Push a new operation to the end of the tape.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L327-L331">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.insert!" href="#Base.insert!"><code>Base.insert!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">insert!(tape::Tape, idx::Integer, ops::AbstractOp...)</code></pre><p>Insert new operations into tape starting from position idx.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L341-L345">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.replace!" href="#Base.replace!"><code>Base.replace!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">replace!(tape, op  =&gt; new_ops; rebind_to=length(new_ops), old_new=Dict())</code></pre><p>Replace specified operation with 1 or more other operations, rebind variables in the reminder of the tape to ops[rebind_to].</p><p>Operation can be specified directly, by a variable or by ID.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L371-L378">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.deleteat!" href="#Base.deleteat!"><code>Base.deleteat!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">deleteat!(tape::Tape, idx; rebind_to = nothing)</code></pre><p>Remove <code>tape[V(idx)]</code> from the <code>tape</code>. If <code>rebind_to</code> is not <code>nothing</code>, then replace all references to <code>V(idx)</code> with <code>V(rebind_to)</code>.</p><p><code>idx</code> may be an index or <code>Variable</code>/<code>AbstractOp</code> directly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L407-L415">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.primitivize!" href="#Umlaut.primitivize!"><code>Umlaut.primitivize!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">primitivize!(tape::Tape; ctx=nothing)</code></pre><p>Trace non-primitive function calls on a tape and decompose them into a list of corresponding primitive calls.</p><p><strong>Example</strong></p><pre><code class="nohighlight hljs">f(x) = 2x - 1
g(x) = f(x) + 5

tape = Tape()
_, x = inputs!(tape, g, 3.0)
y = push!(tape, mkcall(f, x))
z = push!(tape, mkcall(+, y, 5))
tape.result = z

primitivize!(tape)

# output

Tape{BaseCtx}
  inp %1::typeof(g)
  inp %2::Float64
  %3 = *(2, %2)::Float64
  %4 = -(%3, 1)::Float64
  %5 = +(%4, 5)::Float64</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L653-L680">source</a></section></article><h2 id="Tape-execution"><a class="docs-heading-anchor" href="#Tape-execution">Tape execution</a><a id="Tape-execution-1"></a><a class="docs-heading-anchor-permalink" href="#Tape-execution" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.play!" href="#Umlaut.play!"><code>Umlaut.play!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">play!(tape::Tape, args...; debug=false)</code></pre><p>Execute operations on the tape one by one. If <code>debug=true</code>, print each operation before execution.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L610-L615">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.compile" href="#Umlaut.compile"><code>Umlaut.compile</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compile(tape::Tape)</code></pre><p>Compile tape into a normal Julia function.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/compile.jl#L103-L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.to_expr" href="#Umlaut.to_expr"><code>Umlaut.to_expr</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">to_expr(tape::Tape)</code></pre><p>Generate a Julia expression corresponding to the tape.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/compile.jl#L72-L76">source</a></section></article><h2 id="Internal-functions"><a class="docs-heading-anchor" href="#Internal-functions">Internal functions</a><a id="Internal-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Internal-functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.code_signature" href="#Umlaut.code_signature"><code>Umlaut.code_signature</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">code_signature(ctx, v_fargs)</code></pre><p>Returns method signature as a tuple (f, (arg1<em>typ, arg2</em>typ, ...)). This signature is suitable for getcode() and which().</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L463-L468">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.call_signature" href="#Umlaut.call_signature"><code>Umlaut.call_signature</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">call_signature(fn, args...)
call_signature(tape::Tape, op::Call)</code></pre><p>Get a signature of a function call. The obtain signature is suitable for <code>is_primitive(sig)</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L636-L642">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.trace!" href="#Umlaut.trace!"><code>Umlaut.trace!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">trace!(t::Tracer, v_fargs)</code></pre><p>Trace call defined by variables in v_fargs.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L556-L560">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.trace_call!" href="#Umlaut.trace_call!"><code>Umlaut.trace_call!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">trace_call!(t::Tracer{C}, v_f, v_args...) where C</code></pre><p>Customizable handler that controls what to do with a function call. The default implementation checks if the call is a primitive and either records it to the tape or recurses into it.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L305-L311">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.unsplat!" href="#Umlaut.unsplat!"><code>Umlaut.unsplat!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">unsplat!(t::Tracer, v_fargs)</code></pre><p>In the lowered form, splatting syntax f(xs...) is represented as Core.<em>apply</em>iterate(f, xs). unsplat!() reverses this change and transformes v_fargs to a normal form, possibly destructuring xs into separate variables on the tape.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L477-L484">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.map_vars" href="#Umlaut.map_vars"><code>Umlaut.map_vars</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Helper function to map a function only to Variable arguments of a Call leaving constant values as is</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L215-L218">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.block_expressions" href="#Umlaut.block_expressions"><code>Umlaut.block_expressions</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">block_expressions(ir::IRCode)</code></pre><p>For each block, compute a vector of its expressions along with their SSA IDs. Returns Vector{block<em>info}, where block</em>info is Vector{ssa_id =&gt; expr}</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L20-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.promote_const_value" href="#Umlaut.promote_const_value"><code>Umlaut.promote_const_value</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Unwrap constant value from its expression container such as GlobalRef, QuoteNode, etc. No-op if there&#39;s no known container.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/utils.jl#L50-L53">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.loop_exit_vars_at_point" href="#Umlaut.loop_exit_vars_at_point"><code>Umlaut.loop_exit_vars_at_point</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Collect variables which will be used at loop exit if it happens at this point on tape.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L557-L560">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.handle_gotoifnot_node!" href="#Umlaut.handle_gotoifnot_node!"><code>Umlaut.handle_gotoifnot_node!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">handle_gotoifnot_node!(t::Tracer, cf::Core.GotoIfNot, frame::Frame)</code></pre><p>Must return the value associated to a <code>Core.GotoIfNot</code> node. May also have side-effects, such as modifying the tape.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L529-L534">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.is_ho_tracable" href="#Umlaut.is_ho_tracable"><code>Umlaut.is_ho_tracable</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">is_ho_tracable(ctx::Any, f, args...)</code></pre><p>Is higher-order tracable. Returns true if <code>f</code> is a known higher-order function that Umlaut knows how to trace and its functional argument is a non-primitive.</p><p><code>is_ho_tracable()</code> helps to trace through higher-order functions like <code>Core._apply_iterate()</code> (used internally when splatting arguments with ...) as if they themselves were non-primitives.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/trace.jl#L172-L181">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.__foreigncall__" href="#Umlaut.__foreigncall__"><code>Umlaut.__foreigncall__</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function __foreigncall__(
    ::Val{name}, ::Val{RT}, AT::Tuple, ::Val{nreq}, ::Val{calling_convention}, x...
) where {name, RT, nreq, calling_convention}</code></pre><p>:foreigncall nodes get translated into calls to this function. For example,</p><pre><code class="language-julia hljs">Expr(:foreigncall, :foo, Tout, (A, B), nreq, :ccall, args...)</code></pre><p>becomes</p><pre><code class="language-julia hljs">__foreigncall__(Val(:foo), Val(Tout), (Val(A), Val(B)), Val(nreq), Val(:ccall), args...)</code></pre><p>Please consult the Julia documentation for more information on how foreigncall nodes work, and consult this package&#39;s tests for examples.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/utils.jl#L17-L33">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Umlaut.UncalculatedValue" href="#Umlaut.UncalculatedValue"><code>Umlaut.UncalculatedValue</code></a> — <span class="docstring-category">Type</span></header><section><div><p>UncalculatedValue()</p><p>This struct is used to signal that a value on the tape has not been computed. The downstream Call operations using at least one value of type <code>Umlaut.UncalculatedValue</code> will propagate and will also have a result of type <code>Umlaut.UncalculatedValue</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dfdx/Umlaut.jl/blob/cfa48c1d7639c0d4923e76dd6da3ee2960b34209/src/tape.jl#L172-L178">source</a></section></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#Umlaut.AbstractOp"><code>Umlaut.AbstractOp</code></a></li><li><a href="#Umlaut.BaseCtx"><code>Umlaut.BaseCtx</code></a></li><li><a href="#Umlaut.Call"><code>Umlaut.Call</code></a></li><li><a href="#Umlaut.Constant"><code>Umlaut.Constant</code></a></li><li><a href="#Umlaut.Input"><code>Umlaut.Input</code></a></li><li><a href="#Umlaut.Loop"><code>Umlaut.Loop</code></a></li><li><a href="#Umlaut.Tape"><code>Umlaut.Tape</code></a></li><li><a href="#Umlaut.UncalculatedValue"><code>Umlaut.UncalculatedValue</code></a></li><li><a href="#Umlaut.Variable"><code>Umlaut.Variable</code></a></li><li><a href="#Base.deleteat!"><code>Base.deleteat!</code></a></li><li><a href="#Base.insert!"><code>Base.insert!</code></a></li><li><a href="#Base.push!"><code>Base.push!</code></a></li><li><a href="#Base.replace!"><code>Base.replace!</code></a></li><li><a href="#Umlaut.__foreigncall__"><code>Umlaut.__foreigncall__</code></a></li><li><a href="#Umlaut.__new__"><code>Umlaut.__new__</code></a></li><li><a href="#Umlaut.block_expressions"><code>Umlaut.block_expressions</code></a></li><li><a href="#Umlaut.bound"><code>Umlaut.bound</code></a></li><li><a href="#Umlaut.call_signature"><code>Umlaut.call_signature</code></a></li><li><a href="#Umlaut.code_signature"><code>Umlaut.code_signature</code></a></li><li><a href="#Umlaut.compile"><code>Umlaut.compile</code></a></li><li><a href="#Umlaut.handle_gotoifnot_node!"><code>Umlaut.handle_gotoifnot_node!</code></a></li><li><a href="#Umlaut.inputs"><code>Umlaut.inputs</code></a></li><li><a href="#Umlaut.inputs!"><code>Umlaut.inputs!</code></a></li><li><a href="#Umlaut.is_ho_tracable"><code>Umlaut.is_ho_tracable</code></a></li><li><a href="#Umlaut.isprimitive"><code>Umlaut.isprimitive</code></a></li><li><a href="#Umlaut.loop_exit_vars_at_point"><code>Umlaut.loop_exit_vars_at_point</code></a></li><li><a href="#Umlaut.map_vars"><code>Umlaut.map_vars</code></a></li><li><a href="#Umlaut.mkcall"><code>Umlaut.mkcall</code></a></li><li><a href="#Umlaut.play!"><code>Umlaut.play!</code></a></li><li><a href="#Umlaut.primitivize!"><code>Umlaut.primitivize!</code></a></li><li><a href="#Umlaut.promote_const_value"><code>Umlaut.promote_const_value</code></a></li><li><a href="#Umlaut.rebind!"><code>Umlaut.rebind!</code></a></li><li><a href="#Umlaut.rebind_context!"><code>Umlaut.rebind_context!</code></a></li><li><a href="#Umlaut.record_primitive!"><code>Umlaut.record_primitive!</code></a></li><li><a href="#Umlaut.to_expr"><code>Umlaut.to_expr</code></a></li><li><a href="#Umlaut.trace"><code>Umlaut.trace</code></a></li><li><a href="#Umlaut.trace!"><code>Umlaut.trace!</code></a></li><li><a href="#Umlaut.trace_call!"><code>Umlaut.trace_call!</code></a></li><li><a href="#Umlaut.unsplat!"><code>Umlaut.unsplat!</code></a></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ghost/">« Migration from Ghost</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.2 on <span class="colophon-date" title="Saturday 11 November 2023 09:16">Saturday 11 November 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
